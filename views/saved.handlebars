<style>
    .hide{
        display:none;
    }
</style>
{{!-- this is the form we will see when we want to display a note --}}
    <div class="note-wrap hide" data-nid="" data-rid="">
        {{!-- nid and rid are empty bc it will be dynamically generated --}}
        <form class="note-form">
            <h4>Recipe Note</h4>
            <label for="title">Note Title:</label>
            <input type="text" id="title" required> 
            <br/>
            <label for="body">Note Body:</label>
            <textarea id="body" required></textarea>
            </br>
            <button class="update-note">Save</button>
            <button class="cancel-note">Cancel</button>
        </form>
    </div>

    
{{>header home=false saved=true}}
    <div class="uk-flex uk-flex-column uk-width-1-3" uk-grid
        uk-scrollspy="cls: uk-animation-slide-bottom; target: .uk-card; delay: 200; repeat: false">

<h1>Saved Recipes</h1> 
{{#each recipes}}
    {{#if saved}}
    {{!-- it will render --}}
    <div class="uk-card uk-card-default uk-card-body uk-margin-top" id="recipe-wrap" data-rid="{{this._id}}">
            <p>{{this.title}}</p>
            <a class= "uk-button uk-button-default" href="{{this.link}}">Recipe Link</a>
            {{!-- now theres a unsave button --}}
            <button class="uk-button uk-button-default" id="unsave-btn" data-rid="{{this._id}}">Unsave</button>
              {{#unless note}}
              <button class="uk-button uk-button-default" id="add-btn" data-rid="{{this._id}}">Add a note</button>
                {{else}}
                    {{!-- needs functionality: update and delete --}}
                    <div class="note-wrap" data-nid="{{this._id}}">
                        <p class="note-title">{{this.note.title}}</p>
                        <p class="note-body">{{this.note.body}}</p>
                        <button class="uk-button uk-button-default" id="update-btn">Update</button>
                        <button class="uk-button uk-button-default" id="delete-btn">Delete</button>
                    </div>
                {{/unless}}
        </div>
    {{/if}}
{{/each}}



{{!-- if there are no articles to be rendered --}}
{{#unless recipes}}
    <h3>No saved recipes to display yet!</h3>
    <a href="/">Go Scrape</a>
{{/unless}}

<script>
    // jquery for unsave button 
    $("#unsave-btn").on("click", function () {
        var recipeId = $(this).data("rid");

        //update article state from being unsaved to saved 
        var updateRecipe = {
            saved: false
        }
        //to make sure we can grab the id, comment out ajax call and console log id 
        console.log(recipeId);
        console.log(updateRecipe);

        //losing scope = put this outside in global and call again in parentE
        var self = $(this);
        // communicate with server to update article
        $.ajax({
            url: '/recipe/' + recipeId,
            type: 'PUT',
            data: updateRecipe,
            success: function (result) {
                if (true) {
                    //do something with result
                    //check if result comes back as updated
                    //remove item from dom 
                    var parentElm = self.parent("#recipe-wrap");
                    console.log(parentElm);
                    parentElm.remove();
                }
            }
        })
    })

</script>